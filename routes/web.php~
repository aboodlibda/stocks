<?php

use App\Http\Controllers\AuthController;
use App\Http\Controllers\HomeController;
use App\Http\Controllers\PortfolioController;
use App\Http\Controllers\StockController;
use App\Models\Company;
use Illuminate\Support\Facades\Http;
use Illuminate\Support\Facades\Route;
use Mcamara\LaravelLocalization\Facades\LaravelLocalization;


/////////////////////////////////// Localization Route For En And Ar ///////////////////////////////////////////
Route::group(['prefix' => LaravelLocalization::setLocale()], function () {

/////////////////////////////////// Authentication Routes ///////////////////////////////////////////
    Route::get('/login', [AuthController::class, 'showLogin'])->name('login');
    Route::post('/login', [AuthController::class, 'doLogin'])->name('do-login')->middleware('web');
    Route::get('/logout', [AuthController::class, 'logout'])->name('logout');

/////////////////////////////////// Dashboard Routes ///////////////////////////////////////////
    Route::group(['prefix' => 'cms', 'middleware' => ['auth:user']], function () {
        Route::get('/dashboard/', [HomeController::class, 'dashboard'])->name('dashboard');
        Route::resource('portfolios', PortfolioController::class);
        Route::get('notes',[\App\Http\Controllers\NotesController::class,'index'])->name('notes.index');
        Route::get('notes/{note}',[\App\Http\Controllers\NotesController::class,'edit'])->name('notes.edit');
        Route::put('notes/{note}',[\App\Http\Controllers\NotesController::class,'update'])->name('notes.update');
        Route::get('select-stock', [HomeController::class, 'selectStock'])->name('select-stock');
        Route::get('sector-data', [\App\Http\Controllers\SectorController::class, 'index'])->name('sector-data');
        Route::post('upload-sector-data', [\App\Http\Controllers\SectorController::class, 'uploadData'])->name('upload-sector-data');
        Route::get('update-lang-key', [\App\Http\Controllers\NotesController::class,'updateLangKey'])->name('update-lang-key');
        Route::get('titles',[\App\Http\Controllers\TitlesController::class,'index'])->name('titles.index');
        Route::get('titles',[\App\Http\Controllers\TitlesController::class,'edit'])->name('titles.edit');
        Route::put('titles/{title}',[\App\Http\Controllers\NotesController::class,'update'])->name('titles.update');


    });

    Route::get('/get-tooltip-content', [\App\Http\Controllers\NotesController::class, 'getTooltipContent'])->name('get-tooltip-content');

    Route::get('/stock-analysis-screen', [HomeController::class, 'stockAnalysisScreen'])->name('stock-analysis-screen');

    Route::get('/stock', [StockController::class, 'getStock']);
    Route::get('market-stock-screen', [HomeController::class, 'marketStockScreen'])->name('market-stock-screen');
    Route::get('/get-stock-averages', [HomeController::class, 'getStockAverages'])->name('get-stock-averages');
    Route::get('/companies/ajax', [HomeController::class, 'ajaxIndex'])->name('companies.index.ajax');

    Route::get('/companies', [HomeController::class, 'getCompanies']);
    Route::get('/search', [HomeController::class, 'search']);
    Route::get('read-companies', [StockController::class, 'read_companies'])->name('read-companies');
    Route::get('test_api', [StockController::class,'getApi'])->name('get-api');
    Route::get('execute',function(){
        calculateRatiosByCompany(2270);
    });

    Route::get('new_test',function(){
        $url = "https://finance.yahoo.com/quote/7010.SR/key-statistics?p=7010.SR";

        $response = Http::withHeaders([
            "X-RapidAPI-Host" => $this->apiHost,
            "X-RapidAPI-Key" => $this->apiKey
        ])->get($url);

        return $response->successful() ? $response->json() : null;


    });
});





Route::get('/stock-performance', [HomeController::class, 'stockPerformance'])->name('stock-performance');
Route::get('/stock-analysis', [HomeController::class, 'stockAnalysis'])->name('stock-analysis');
Route::get('/resistance-support', [HomeController::class, 'getResistanceAndSupport'])->name('get-resistance-and-support');
Route::get('/get-close-prices', [HomeController::class, 'getClosePrices'])->name('get-close-prices');
Route::get('/update-stock-var', [HomeController::class, 'updateStockVar'])->name('update-stock-var');
